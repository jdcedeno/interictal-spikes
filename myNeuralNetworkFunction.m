function [Y,Xf,Af] = myNeuralNetworkFunction(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Generated by Neural Network Toolbox function genFunction, 26-Apr-2017 20:22:59.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 20xQ matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 1xQ matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [-0.599494874477386;-0.723485291004181;-0.599494874477386;-0.599494874477386;-0.877920627593994;-0.599494874477386;-0.599494874477386;-0.599494874477386;-0.599494874477386;-1.01246464252472;-0.599494874477386;-0.599494874477386;-0.599494874477386;-0.599494874477386;-0.599494874477386;-0.599494874477386;-0.599494874477386;-0.70692777633667;-0.599494874477386;-0.715316712856293];
x1_step1.gain = [1.23300735161155;1.14544863105904;1.23300735161155;1.23300735161155;1.05236787878624;1.23300735161155;1.23300735161155;1.23300735161155;1.23300735161155;0.98279126935023;1.23300735161155;1.23300735161155;1.23300735161155;1.23300735161155;1.23300735161155;1.23300735161155;1.23300735161155;1.14815694337552;1.23300735161155;1.15083262117464];
x1_step1.ymin = -1;

% Layer 1
b1 = [1.6342574914734405;1.5783278259871765;-0.90239014700653886;-1.1189192991801178;-0.95905675779997956;0.94409645526000452;0.96930821941650036;0.36719195229032003;-0.038696077620496358;0.24956788965505552;0.072551883153727958;-0.045378205517274506;-0.28379371905217193;0.58597837478566972;-0.76769047949012403;0.45936906129275534;-1.022457329984287;1.4485201451815517;1.2217877524819831;-1.593852635536404];
IW1_1 = [-0.26109248174096539 -0.38366091058050139 -0.51199971064634908 0.36484419412666813 -0.46117076366584436 0.14936207180819661 0.42382284096044548 0.073891570785727764 0.30798308180930928 0.19661561651761708 -0.55876861365950814 -0.51530286266183645 0.42554371073576491 0.24034913408774963 0.17660543386731123 0.15646113616550164 -0.14444219513634554 0.46633045214646468 0.10535652270970045 0.57308457901102017;-0.39052603551425086 0.34215446869366334 -0.54892226735105176 -0.43477479434702343 -0.030034510092831004 0.47147578881709795 -0.40002602684371147 -0.28431892825038552 -0.14495329893319001 0.27141660389437255 0.46077788671882958 0.023962891728688155 -0.41964054729933914 -0.51477542577573399 0.2546503536098873 0.40172338891684367 0.054381426250783925 -0.46762674766410595 0.39942054393320858 -0.063123336158871488;0.20255337593747122 -0.018722036059135368 -0.72982248635875291 -0.033680564802049472 1.4972221903844336 -0.61077484975705576 0.23911216112826647 0.5920850401737453 -0.64930183031392841 0.93745266178551712 0.14084383767287995 -0.028172212989614021 -0.15100291401172722 -0.38997303470987027 -0.3572002033368164 0.23479116894234728 -0.57129655494289644 0.79376789039029427 0.5725180657786032 0.75598145547489248;0.04800289671083089 0.28345035941366875 0.19355510897827669 0.51071144437098381 -0.36449077184109024 0.059740218260375282 -0.094339843632098644 0.4241430198423442 0.62417200281451779 -0.32535439416905365 0.55816533800951362 0.24169105864420762 -0.4298198890772208 -0.25589944660419789 -0.28256434304568601 0.63537191707538532 -0.34760240285243488 -0.065729085425579092 -0.042985631125944952 0.56220713643251308;0.66183073737736975 -0.77435154022676755 0.23510919689728496 -0.22416334974629626 -1.8117360297694767 0.55600756033461729 0.0077355800521586781 0.85577456038708588 -0.38922857913134273 0.010655707000494067 -0.64973038872344047 -0.19079819005637794 -0.28770265047309757 -0.021587383219683481 0.72324305883157902 -0.24754507300560452 0.23822713133210022 -0.50539968006298763 0.33401269020953578 -0.97975571093067881;-0.28652775912076656 0.45059233338960286 -0.085167000708145701 -0.056956034254041513 -0.23208912624057404 -0.51685834738588365 -0.45829658410362184 0.063437770211050695 0.55913047443123287 -0.41870627573766528 -0.40456369191349495 -0.58012524065411186 0.19620865739734789 -0.22499409280215624 -0.37380917919709333 -0.24547379882698042 0.17332020639076295 -0.50952435913742278 0.17627258477297225 0.21437119108487129;-0.43916540250708275 0.22203697658708044 0.36246789288150055 0.19716814769095331 -0.47789130259051471 -0.11887844308669283 -0.74286342309852738 -0.10417345587282127 0.61157980306916238 -0.1900518593679347 -0.04167444588674038 0.032804192032904279 -0.44717920217637708 0.051415605984206462 0.86250017225375553 -0.37881745812361162 0.56718477410029811 0.79497643725466194 0.5943559098175748 0.22127099141899098;-0.11974843238214018 0.49608555636845736 -0.40326389378697902 0.37385610329907792 -0.57109134052366206 -0.53625248670906345 0.001300308842537375 -0.65538355631103629 -0.48253839243226831 -0.0023600417384246428 -0.31925371132870506 0.024905775058510698 0.061582075765471242 -0.086008703453665125 -0.72486883839845517 -0.077960070118015923 -0.56314706874813913 0.4141205998229473 -0.13477143467667033 -0.022311583344094343;0.14533315064416491 0.038923369151995423 0.27676338799121514 0.04432205172543055 0.044668613056886422 0.58198733775759182 0.098972195211820102 -0.14204180603195971 0.44239556088450821 -0.13343113298869275 -0.35044049672590699 0.0130012948259515 -0.042693433234489243 0.35149567423058214 -0.34645915064507299 -0.21925064597161101 0.3456571268238483 -0.53184886379611618 0.25931932905040556 -0.92179930780433972;-0.40131167888409691 -0.098049085204708231 -0.51660914645222034 -0.21870597098736935 -0.68150596605278413 0.58752745448435084 -0.010585413192524058 0.021873048354579757 -0.036084836014453378 0.79753216533955329 0.34381231816004632 -0.67371621148180694 0.090233924555718256 -0.12777668022004382 -0.34211673581830293 0.22362039473973463 -0.030342895090556307 0.15316775985196307 0.36180956173479517 -0.53769885833270692;-0.41296030696650199 -0.42881270366291013 -0.19111601491632063 -0.60534491732776663 -1.7149318420286215 0.24375705382146118 0.19900815659452548 0.44002999219373273 0.43581718555709714 -0.43681780233763051 -0.58482747191457662 0.31992662719223747 -0.31166725617378266 0.37435525811307147 0.45322171393222677 -0.43916275324654702 -0.63894428997721409 -1.1647464369713392 0.2269647198965028 -1.0893939560534212;0.16164962826547088 -0.13620269497552717 0.34210353920383174 -0.095233029678248982 -1.013468030045892 -0.15281077855553132 0.68526087943460112 0.13588272722649525 0.11189167730849073 -0.94899371257284826 0.32636459684114399 0.76455355103348077 0.39706708468307783 -0.39081214833761835 0.66591399033986653 -0.30645038797576984 0.27303722940996566 -0.66093397783996555 -0.42278319324954716 0.29369562364245272;-0.28140598188551652 0.74100309982116297 0.90126936161918569 0.55848135694006051 0.10321689001814938 0.14689480723498646 -0.070943491798363387 -0.24095729155666956 0.43613982392991513 0.41304253278180197 -0.29688615210272296 0.39446233715126289 -0.2230951660092311 0.26146169968669297 0.40685784714706691 0.32998196388247192 0.54527671768307817 0.31875129297292382 -0.47245155755256507 -0.20964410507412568;0.46262881699759956 -0.40567477468964874 -0.3491339128660963 0.058933560299891316 -0.17430219977142924 0.43664218389079612 -0.32007116411271341 0.58019945909551129 0.10713732509793253 -0.60440581013140837 -0.69201759109855021 0.039042160135113593 -0.50491061759692379 0.021524630515038164 -0.13474201128250107 -0.23556120159871236 -0.4861908674246283 -0.22672815353163714 0.52118124884528305 -0.15640001259676073;-0.515074144990746 0.20031172073672318 0.32696771925560597 0.45036763812098474 -0.22895922978749203 0.3892233816638595 -0.17080806384063302 0.2299758873436763 0.11985466237700503 0.70403169047240299 0.40237646362471646 -0.30928753684729332 -0.46198018780406774 0.051141912020547499 -0.38845667253222604 0.31639357584360861 0.091338691558276772 0.03321065487580456 0.030056342199892207 -0.80706635782402825;0.49373910671609855 0.0052029846506924703 0.24439717481609327 0.024326051427642451 -0.22036552796986891 0.38957017817201128 0.40226893935076707 -0.010096343005950609 0.33305735047808305 0.4677140566303169 0.44960107966558316 0.19570348724261522 0.57435572129627721 0.62648158765153472 0.79275597475620008 0.59296929742205473 0.75839430316051359 0.30771689926405293 0.77620105000512551 0.47491990965848119;-0.54944802020268901 0.5925596071210294 0.080443674928061829 0.5435383466488124 0.35722413497723376 0.47552081971040738 0.029804653596770203 -0.11632531412102511 -0.42251871473010916 -0.15592767479683378 -0.28065323528204145 -0.49002705608533703 -0.15864921230614523 0.1533654890186526 -0.081522891480420592 0.17025848122688256 0.4875330568707929 -0.47501389365567226 0.21775176722689549 0.58319887417962502;0.45087919700191942 -0.3747526486233308 -0.42076465760865284 -0.39010306637264791 0.069744491595084696 0.58032035051459219 -0.21107037686934763 -0.40813026635849353 0.11971621441251359 0.025450827067760733 0.45966258179679242 -0.089673191592510429 -0.31824222732727214 0.11137301374714662 0.14474220823552952 0.14374946752547904 0.20337656077670802 -0.6117151416797405 0.47902627000670328 -0.19283604256435136;0.19623620871097161 0.1202668506575164 -0.59141796773547128 -0.12113985870046939 0.51849035644183228 0.50996003735998297 -0.0094924534325510901 0.036338100164307503 -0.34024122515197214 0.29503298382326038 0.58203534802913359 0.67949257280329045 0.60234356700415681 0.62390823040536736 -0.81322768303426263 -0.1428056709729679 -0.27763211136426391 -1.4580952344802491 0.37625425235051507 -0.29172592311690099;-0.38802372000052937 -0.29301142667777835 0.2732705373992188 -0.3021290043748468 0.43568924128262199 0.42549491558482783 0.4904862733337651 -0.1463534241928118 0.51814404639741307 0.40365970974578047 -0.15172190156052984 0.56670910933149299 0.20151200618175677 -0.1484827820471796 -0.44760401290009549 -0.27121360089173724 0.25285682727100506 0.15675568643343701 -0.46803132941575143 0.49188767263456135];

% Layer 2
b2 = -0.32121023555952716;
LW2_1 = [-0.56883192234484314 -1.1772304727333469 -1.4168493376104667 0.62645111265201514 -1.8794457226945531 -0.47623987677986884 -1.1487526859192225 -0.5943221486313911 -0.38951027154380746 0.59208333836643545 1.5936022121314588 -1.3334003938962926 1.0207894756974758 0.26470844720899905 -0.3742446555945767 1.1809173144102219 -0.35749940765823018 -0.47402591805775535 -1.8104602210095213 -0.10003243634762636];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
    X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},2); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = logsig_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
    Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Positive Transfer Function
function a = logsig_apply(n,~)
a = 1 ./ (1 + exp(-n));
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end
